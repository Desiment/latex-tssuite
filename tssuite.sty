% ==============================================================================
% TEXT SUITE PACKAGE (tssuite)
% A LaTeX package for typography enhancements, shortcuts, and theorem management
% ==============================================================================

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tssuite}[2026/01/01 Typography and text utilities package]

% ==============================================================================
% DEPENDENCIES
% ==============================================================================

\RequirePackage{stackengine}      % Create vertically stacked boxes for complex layouts
\RequirePackage{multicol}         % Switching between single/multi-column formats
\RequirePackage{microtype}        % Typography enhancements: protrusion, expansion
\RequirePackage{enumitem}         % Enhanced list environments with fine control

% ==============================================================================
% ENUMITEM CONFIGURATION
% ==============================================================================

% Compact list style: removes vertical spacing between items
\SetEnumitemKey{compact}{topsep=0pt, parsep=0pt, noitemsep}

% Custom list styles for consistent typography
\SetEnumitemKey{widemargins}{
    leftmargin=2em,
    labelindent=1em,
    labelsep=0.5em
}

% Inline list style for horizontal lists
\SetEnumitemKey{inline}{
    itemjoin=\quad,
    before=\unskip\space,
    after=\unskip
}

% ==============================================================================
% PACKAGE OPTIONS
% ==============================================================================

% Package option flags - control which features are enabled
\newif\if@tssuite@shortcuts       % Enable shortcut commands for names/terms
\newif\if@tssuite@todos           % Enable todo notes functionality
\newif\if@tssuite@theorems        % Enable theorem environments

% Initialize all options to false by default
\@tssuite@shortcutsfalse
\@tssuite@todosfalse
\@tssuite@theoremsfalse

% Process user options
\DeclareOption{shortcuts}{\@tssuite@shortcutstrue}
\DeclareOption{todos}{\@tssuite@todostrue}
\DeclareOption{theorems}{\@tssuite@theoremstrue}
\DeclareOption*{\PackageWarning{tssuite}{Unknown option '\CurrentOption'}}
\ProcessOptions\relax

% ==============================================================================
% SHORTCUT COMMANDS (enabled with 'shortcuts' option)
% ==============================================================================

% Create shortcut commands for frequently used names/terms
% Usage:
%   \DefineScName[Cpp]{C++}          creates \Cpp command
%   \DefineScNames{GitHub, Python}   creates \Github and \Python commands
\if@tssuite@shortcuts
\ExplSyntaxOn
  \cs_set:Npn\__make_sc_name_command:n#1{
	\seq_set_split:Nnn\l_csname_parts_seq{~}{#1}
	\str_set_eq:NN\l_csname_str\c_empty_tl
	\exp_args:Nx\clist_map_inline:nn{\seq_use:Nnnn\l_csname_parts_seq{,}{,}{,}}{\exp_args:NNx\str_put_right:Nn\l_csname_str{\str_uppercase:f{\tl_head:n{##1}}\str_lowercase:f{\tl_tail:n{##1}}}}
	\exp_args:NNf\exp_args:Nc\NewDocumentCommand{\str_use:N\l_csname_str}{}{#1}
  }
  \NewDocumentCommand\DefineScName{om}{
	\IfNoValueTF{#1}{\__make_sc_name_command:n#2}{\exp_args:Nc\NewDocumentCommand{#2}{}{\textsc{#1}}}
  }
  \NewDocumentCommand\DefineScNames{ >{\SplitList {,}} m}{
	\ProcessList{#1}{\__make_sc_name_command:n}
  }
\ExplSyntaxOff
\fi
% ==============================================================================
% TODO NOTES (enabled with 'todos' option)
% ==============================================================================

% Note: todonotes uses TikZ internally, which can become slow with many todos
% Future enhancement: make todo engine configurable (tikz vs simple)
% TODO: Add Russian translation for todonotes (consider PR to the package)
% TODO: make possible to choose engine for todo:
% TODO: make todonotes configurable
\if@tssuite@todos
  \RequirePackage{todonotes}
  % If memoize package is loaded, disable memoization for todos to prevent issues
  \IfPackageLoadedTF{memoize}{%
	\NewCommandCopy\LaTeXtodo\todo%
	\RenewDocumentCommand{\todo}{om}{%
	  \IfNoValueTF{#1}{%
		\bgroup\mmzset{disable}\LaTeXtodo{#2}\egroup%
	  }{%
		\bgroup\mmzset{disable}\LaTeXtodo[#1]{#2}\egroup%
	  }%
	}%
  }
\fi

% ==============================================================================
% THEOREM ENVIRONMENTS (enabled with 'theorems' option)
% ==============================================================================

\if@tssuite@theorems
  \RequirePackage{amsthm}           % Theorem environment support
  \RequirePackage{keytheorems}      % Enhanced theorem management
  
  % Unified theorem creation command
  % \NewDocumentTheorem{Theorem}{name}{options}[numbered ver. options](unnumbered ver. options)
  % Creates: theorem environment (numbered) and theorem* environment (unnumbered)
  % Note that for consistency, environment name is converted to lowercase
  \ExplSyntaxOn
  \NewDocumentCommand{\NewDocumentTheorem}{mmmd[]d()}{
	\tl_set:Nn\l_env_name_tl{\str_lowercase:n{#1}}
	\IfNoValueTF{#4}{
	  \exp_args:Nf\newkeytheorem{\tl_use:N\l_env_name_tl}[name=#2, #3]
	}{
	  \exp_args:Nf\newkeytheorem{\tl_use:N\l_env_name_tl}[name=#2, #4, #3]
	}
	\IfNoValueTF{#5}{
	  \exp_args:Nf\newkeytheorem{\tl_use:N\l_env_name_tl*}[name=#2, numbered=false, #3]
	}{
	  \exp_args:Nf\newkeytheorem{\tl_use:N\l_env_name_tl*}[name=#2, numbered=false, #5, #3]
	}
  }
  \ExplSyntaxOff


  
  \NewDocumentCommand{\framesetup}{m}{
    \IfNoValueTF{#1}{
        \mdfsetup{innertopmargin=-3pt,linecolor=black,%
              linewidth=1pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    }{
        \mdfsetup{frametitle={%
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=white]{\strut #1};}}
        \mdfsetup{innertopmargin=-10pt,linecolor=black,%
              linewidth=1pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    }
  }
    
  \IfPackageLoadedTF{memoize}{%
	\NewDocumentCommand{\MakeFramedTheorem}{mm}{
		\NewDocumentEnvironment{#1}{oO{}}
		{\framesetup{##1}\begin{mdframed}\begin{#2}[##2]}
        	{\end{#2}\end{mdframed}}
	}
  }{%
	\NewDocumentCommand{\MakeFramedTheorem}{mm}{
		\NewDocumentEnvironment{#1}{oO{}}
		{\mmzset{disabe}\framesetup{##1}\begin{mdframed}\begin{#2}[##2]}
		{\end{#2}\end{mdframed}\mmszet{enable}}
	}
  }
\fi

\endinput
